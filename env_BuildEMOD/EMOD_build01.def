Bootstrap: library
From: centos:latest

%post
    dnf install python3-devel -y
    dnf install mpich-devel -y
    dnf install sqlite-devel -y
    dnf install boost-devel -y
    dnf install git -y

    dnf group install "Development Tools" -y

    dnf clean all

    python3 -m pip install pip --upgrade
    python3 -m pip install scons

    export USER=CalculonUser-EMOD
    export PATH=$PATH:/usr/lib64/mpich/bin
    export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/lib64/mpich/lib

    git clone https://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@github.com/kfrey-idm/DtkTrunk.git

    cd DtkTrunk

    git fetch
    git checkout Generic-Ongoing

    scons --Release --jobs=4 --Disease=Generic

    cd ..

    mkdir outputs
    cp DtkTrunk/build/x64/Release/Eradication/Eradication outputs/Eradication.exe

    mkdir outputs/reporter_plugins
    cp DtkTrunk/build/x64/Release/reporter_plugins/*.so outputs/reporter_plugins

    outputs/Eradication.exe --get-schema --schema-path outputs/schema.json -P DtkTrunk/Scripts

    rm -r DtkTrunk

%runscript


%environment


%test


%labels
    Author kfrey@idmod.org

%help
    Temp container for building EMOD.